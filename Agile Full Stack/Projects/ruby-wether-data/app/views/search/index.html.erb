<!-- app/views/search/index.html.erb -->
<!-- 4.1 Simple Search & 4.2 Hierarchical Search -->
<div class="row mb-4">
  <div class="col-12">
    <h1>Search</h1>
    <p class="lead">Search across cities, climate zones, and weather conditions.</p>
  </div>
</div>



<% if @query.present? %>
  <div class="row">
    <div class="col-12">
      <h2>Search Results for "<%= @query %>"</h2>

      <% if @category.present? && @results %>
        <!-- Single category results -->
        <div class="alert alert-info">
          <strong><%= @result_type %>:</strong> Found <%= @results.total_count %> results
        </div>

        <% if @results.any? %>
          <% case @category %>
      <% when 'city' %>
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead class="table-dark">
                <tr>
                  <th>City Name</th>
                  <th>Country</th>
                  <th>Climate Zones</th>
                  <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <% @results.each do |city| %>
                  <tr>

                    <td><%= link_to city.city_name, city_path(city), class: "fw-bold" %></td>
                    <td><%= city.country_name %></td>
                    <td>
                      <%= city.climate_zones.map(&:zone_name).join(", ") %>
                    </td>
                    <td>
                      <%= link_to "View", city_path(city), class: "btn btn-sm btn-primary" %>
                    </td>
                  </tr>
                <% end %>
                </tbody>
              </table>
            </div>

          <% when 'climate' %>
            <div class="row">
              <% @results.each do |zone| %>
                <div class="col-md-4 mb-3">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title"><%= zone.zone_name %></h5>
                      <p class="card-text"><small class="text-muted">Code: <%= zone.zone_code %></small></p>
                      <%= link_to "View Details", zone_path(zone), class: "btn btn-primary btn-sm" %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>

          <% when 'weather' %>
            <div class="row">
              <% @results.each do |condition| %>
                <div class="col-md-4 mb-3">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title"><%= condition.condition_name %></h5>
                      <p class="card-text"><small class="text-muted">Code: <%= condition.condition_code %></small></p>
                      <%= link_to "View Details", condition_path(condition), class: "btn btn-info btn-sm" %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>

          <div class="d-flex justify-content-center mt-4">
            <%= paginate @results %>
          </div>
        <% else %>
          <div class="alert alert-warning">
            <p>No results found in <%= @result_type %> for "<%= @query %>".</p>
          </div>
        <% end %>

      <% else %>
        <!-- All categories results -->
        <div class="row">
          <!-- Cities Results -->
          <div class="col-12 mb-4">
            <h3>Cities</h3>
            <% if @cities && @cities.any? %>
              <div class="list-group">
                <% @cities.each do |city| %>
                  <%= link_to city_path(city), class: "list-group-item list-group-item-action" do %>
                    <div class="d-flex w-100 justify-content-between">
                      <h5 class="mb-1"><%= city.city_name %></h5>
                      <small class="text-muted"><%= city.country_name %></small>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <%= link_to "View all city results", search_path(q: @query, category: 'cities'),
                          class: "btn btn-outline-primary mt-2" %>
            <% else %>
              <p class="text-muted">No cities found.</p>
            <% end %>
          </div>

          <!-- Climate Zones Results -->
          <div class="col-12 mb-4">
            <h3>Climate Zones</h3>
            <% if @climate_zones && @climate_zones.any? %>
              <div class="list-group">
                <% @climate_zones.each do |zone| %>
                  <%= link_to zone_path(zone), class: "list-group-item list-group-item-action" do %>
                    <div class="d-flex w-100 justify-content-between">
                      <h5 class="mb-1"><%= zone.zone_name %></h5>
                      <small class="text-muted">Code: <%= zone.zone_code %></small>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <%= link_to "View all zone results", search_path(q: @query, category: 'climate_zones'),
                          class: "btn btn-outline-success mt-2" %>
            <% else %>
              <p class="text-muted">No climate zones found.</p>
            <% end %>
          </div>

          <!-- Weather Conditions Results -->
          <div class="col-12 mb-4">
            <h3>Weather Conditions</h3>
            <% if @weather_conditions && @weather_conditions.any? %>
              <div class="list-group">
                <% @weather_conditions.each do |condition| %>
                  <%= link_to condition_path(condition), class: "list-group-item list-group-item-action" do %>
                    <div class="d-flex w-100 justify-content-between">
                      <h5 class="mb-1"><%= condition.condition_name %></h5>
                      <small class="text-muted">Code: <%= condition.condition_code %></small>
                    </div>
                  <% end %>
                <% end %>
              </div>
              <%= link_to "View all condition results", search_path(q: @query, category: 'weather_conditions'),
                          class: "btn btn-outline-info mt-2" %>
            <% else %>
              <p class="text-muted">No weather conditions found.</p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% else %>
  <div class="row">
    <div class="col-lg-8 mx-auto">
      <div class="alert alert-info">
        <h4 class="alert-heading">How to Search</h4>
        <p>Enter keywords to search across:</p>
        <ul>
          <li>City names and countries</li>
          <li>Climate zone names and descriptions</li>
          <li>Weather condition types</li>
        </ul>
        <hr>
        <p class="mb-0">Use the category dropdown to narrow your search to a specific type of data.</p>
      </div>
    </div>
  </div>
<% end %>